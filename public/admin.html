<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel do Administrador - C.I. Plenitude</title>
  <link rel="icon" type="image/png" href="/favicon.png">
  <link href="/tailwind.output.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <div id="loginContainer" class="flex flex-col items-center justify-center min-h-screen bg-gray-50 text-gray-800" style="display:none;">
    <div class="bg-white rounded-xl shadow-xl p-8 w-full max-w-md">
      <h2 class="text-2xl font-bold text-orange-800 mb-4 text-center">Login do Administrador</h2>
      <form id="loginForm" class="space-y-4">
        <input type="email" id="email" class="w-full px-4 py-2 border rounded-lg" placeholder="E-mail" required />
        <input type="password" id="password" class="w-full px-4 py-2 border rounded-lg" placeholder="Senha" required />
        <button type="submit" class="w-full bg-orange-800 text-white font-semibold px-4 py-2 rounded-lg shadow hover:bg-orange-700 transition duration-150">Entrar</button>
        <p id="loginError" class="text-red-600 text-center mt-2"></p>
      </form>
    </div>
  </div>
  <div id="adminPanel" style="display:none;">
    <header class="bg-orange-800 text-white shadow-md sticky top-0 z-50">
    <div class="max-w-7xl mx-auto flex justify-between items-center px-6 py-4">
      <h1 class="text-2xl font-bold">Administração - C.I. Plenitude</h1>
      <nav class="space-x-6 hidden md:block">
        <a href="#dashboard" class="hover:text-gray-300">Dashboard</a>
        <a href="#mensagens" class="hover:text-gray-300">Mensagens</a>
        <a href="#usuarios" class="hover:text-gray-300">Usuários</a>
        <a href="#configuracoes" class="hover:text-gray-300">Configurações</a>
        <a href="/admin.html" class="bg-white text-orange-800 font-semibold px-4 py-2 rounded-lg shadow hover:bg-orange-100 transition duration-150 ml-4">Colaborador</a>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-6 py-12">
    <section id="midias" class="mb-12">
      <h2 class="text-3xl font-bold text-orange-800 mb-4">Mídias Sociais</h2>
      <div id="midiasContainer" class="bg-white rounded-xl shadow-xl p-6 space-y-4">
        <form id="formMidias" class="space-y-2">
          <input type="url" id="midiaFacebook" class="w-full px-4 py-2 border rounded-lg" placeholder="URL do Facebook" />
          <input type="url" id="midiaInstagram" class="w-full px-4 py-2 border rounded-lg" placeholder="URL do Instagram" />
          <input type="url" id="midiaYoutube" class="w-full px-4 py-2 border rounded-lg" placeholder="URL do YouTube" />
          <button type="submit" class="bg-orange-800 text-white px-4 py-2 rounded-lg shadow hover:bg-orange-700">Salvar</button>
          <p id="midiaMsg" class="text-green-600 mt-2"></p>
        </form>
      </div>
    </section>
    <section id="privacidade" class="mb-12">
      <h2 class="text-3xl font-bold text-orange-800 mb-4">Política de Privacidade</h2>
      <div id="privacidadeContainer" class="bg-white rounded-xl shadow-xl p-6 space-y-4">
        <form id="formPrivacidade" class="space-y-2">
          <textarea id="privacidadeTexto" class="w-full px-4 py-2 border rounded-lg" placeholder="Texto da política" required></textarea>
          <button type="submit" class="bg-orange-800 text-white px-4 py-2 rounded-lg shadow hover:bg-orange-700">Salvar</button>
          <p id="privacidadeMsg" class="text-green-600 mt-2"></p>
        </form>
      </div>
    </section>
    <section id="meditacoes" class="mb-12">
      <h2 class="text-3xl font-bold text-orange-800 mb-4">Meditações Diárias</h2>
      <div id="meditacoesContainer" class="bg-white rounded-xl shadow-xl p-6 space-y-4">
        <div class="flex flex-wrap gap-4 mb-4">
          <button id="btnListarMeditacoes" class="bg-orange-800 text-white px-4 py-2 rounded-lg shadow hover:bg-orange-700">Listar Meditações</button>
          <button id="btnCadastrarMeditacao" class="bg-green-600 text-white px-4 py-2 rounded-lg shadow hover:bg-green-700">Cadastrar Meditação</button>
        </div>
        <div id="meditacoesList" class="overflow-x-auto"></div>
        <form id="formMeditacao" class="space-y-2 hidden">
          <input type="text" id="meditacaoTema" class="w-full px-4 py-2 border rounded-lg" placeholder="Tema" required />
          <textarea id="meditacaoTexto" class="w-full px-4 py-2 border rounded-lg" placeholder="Texto/reflexão" required></textarea>
          <input type="text" id="meditacaoVersiculo" class="w-full px-4 py-2 border rounded-lg" placeholder="Versículo" required />
          <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-lg shadow hover:bg-green-700">Salvar</button>
          <button type="button" id="cancelarMeditacao" class="bg-gray-400 text-white px-4 py-2 rounded-lg shadow hover:bg-gray-500">Cancelar</button>
          <p id="meditacaoMsg" class="text-green-600 mt-2"></p>
        </form>
      </div>
    </section>
    <section id="ministerios" class="mb-12">
      <h2 class="text-3xl font-bold text-orange-800 mb-4">Ministérios</h2>
      <div id="ministeriosContainer" class="bg-white rounded-xl shadow-xl p-6 space-y-4">
        <div class="flex flex-wrap gap-4 mb-4">
          <button id="btnListarMinisterios" class="bg-orange-800 text-white px-4 py-2 rounded-lg shadow hover:bg-orange-700">Listar Ministérios</button>
          <button id="btnCadastrarMinisterio" class="bg-green-600 text-white px-4 py-2 rounded-lg shadow hover:bg-green-700">Cadastrar Ministério</button>
        </div>
        <div id="ministeriosList" class="overflow-x-auto"></div>
        <form id="formMinisterio" class="space-y-2 hidden">
          <input type="text" id="ministerioNome" class="w-full px-4 py-2 border rounded-lg" placeholder="Nome do ministério" required />
          <textarea id="ministerioDescricao" class="w-full px-4 py-2 border rounded-lg" placeholder="Descrição" required></textarea>
          <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-lg shadow hover:bg-green-700">Salvar</button>
          <button type="button" id="cancelarMinisterio" class="bg-gray-400 text-white px-4 py-2 rounded-lg shadow hover:bg-gray-500">Cancelar</button>
          <p id="ministerioMsg" class="text-green-600 mt-2"></p>
        </form>
      </div>
    </section>
    <section id="dashboard" class="mb-12">
      <h2 class="text-3xl font-bold text-orange-800 mb-4">Dashboard</h2>
      <div class="grid md:grid-cols-3 gap-8">
        <div class="bg-white shadow-xl rounded-xl p-8 text-center">
          <h3 class="font-extrabold text-xl mb-2">Total de Mensagens</h3>
          <p id="totalMensagens" class="text-3xl font-bold text-orange-800">--</p>
        </div>
    <section id="cultos" class="mb-12">
      <h2 class="text-3xl font-bold text-orange-800 mb-4">Cultos</h2>
      <div id="cultosContainer" class="bg-white rounded-xl shadow-xl p-6 space-y-4">
        <div class="flex flex-wrap gap-4 mb-4">
          <button id="btnListarCultos" class="bg-orange-800 text-white px-4 py-2 rounded-lg shadow hover:bg-orange-700">Listar Cultos</button>
          <button id="btnCadastrarCulto" class="bg-green-600 text-white px-4 py-2 rounded-lg shadow hover:bg-green-700">Cadastrar Culto</button>
        </div>
        <div id="cultosList" class="overflow-x-auto"></div>
        <form id="formCulto" class="space-y-2 hidden">
          <input type="text" id="cultoTitulo" class="w-full px-4 py-2 border rounded-lg" placeholder="Título do culto" required />
          <input type="datetime-local" id="cultoData" class="w-full px-4 py-2 border rounded-lg" required />
          <textarea id="cultoDescricao" class="w-full px-4 py-2 border rounded-lg" placeholder="Descrição" required></textarea>
          <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-lg shadow hover:bg-green-700">Salvar</button>
          <button type="button" id="cancelarCulto" class="bg-gray-400 text-white px-4 py-2 rounded-lg shadow hover:bg-gray-500">Cancelar</button>
          <p id="cultoMsg" class="text-green-600 mt-2"></p>
        </form>
      </div>
    </section>
        <div class="bg-white shadow-xl rounded-xl p-8 text-center">
          <h3 class="font-extrabold text-xl mb-2">Usuários Ativos</h3>
          <p id="usuariosAtivos" class="text-3xl font-bold text-orange-800">--</p>
        </div>
        <div class="bg-white shadow-xl rounded-xl p-8 text-center">
          <h3 class="font-extrabold text-xl mb-2">Última Mensagem</h3>
          <p id="ultimaMensagem" class="text-lg text-gray-700">--</p>
        </div>
      </div>
    </section>

    <section id="mensagens" class="mb-12">
      <h2 class="text-3xl font-bold text-orange-800 mb-4">Mensagens Recebidas</h2>
      <div id="mensagensContainer" class="bg-white rounded-xl shadow-xl p-6 overflow-x-auto">
        <table class="min-w-full">
          <thead>
            <tr class="bg-orange-100">
              <th class="py-2 px-4 text-left">Nome</th>
              <th class="py-2 px-4 text-left">E-mail</th>
              <th class="py-2 px-4 text-left">Telefone</th>
              <th class="py-2 px-4 text-left">WhatsApp</th>
              <th class="py-2 px-4 text-left">Mensagem</th>
              <th class="py-2 px-4 text-left">Data</th>
            </tr>
          </thead>
          <tbody id="mensagensTable">
            <!-- Mensagens serão inseridas aqui via JS -->
          </tbody>
        </table>
      </div>
    </section>

    <section id="usuarios" class="mb-12">
      <h2 class="text-3xl font-bold text-orange-800 mb-4">Usuários</h2>
      <div id="usuariosContainer" class="bg-white rounded-xl shadow-xl p-6">
        <p class="text-gray-600">Funcionalidade de gerenciamento de usuários em breve.</p>
      </div>
    </section>

    <section id="configuracoes" class="mb-12">
      <h2 class="text-3xl font-bold text-orange-800 mb-4">Configurações</h2>
      <div class="bg-white rounded-xl shadow-xl p-6 space-y-6">
        <!-- Troca de imagem do topo -->
        <div>
          <h3 class="text-xl font-bold mb-2">Trocar imagem do topo (banner)</h3>
          <form id="bannerForm" class="flex flex-col md:flex-row items-center gap-4">
            <input type="url" id="bannerUrl" class="px-4 py-2 border rounded-lg flex-1" placeholder="URL da nova imagem" required />
            <button type="submit" class="bg-orange-800 text-white font-semibold px-4 py-2 rounded-lg shadow hover:bg-orange-700 transition duration-150">Salvar</button>
          </form>
          <img id="bannerPreview" src="" alt="Prévia do banner" class="mt-4 rounded-xl shadow w-full max-w-lg" style="display:none;" />
          <p id="bannerMsg" class="text-green-600 mt-2"></p>
        </div>
        <!-- Alterar senha -->
        <div>
          <h3 class="text-xl font-bold mb-2">Alterar senha</h3>
          <form id="senhaForm" class="flex flex-col md:flex-row items-center gap-4">
            <input type="password" id="novaSenha" class="px-4 py-2 border rounded-lg flex-1" placeholder="Nova senha" required />
            <button type="submit" class="bg-orange-800 text-white font-semibold px-4 py-2 rounded-lg shadow hover:bg-orange-700 transition duration-150">Alterar</button>
          </form>
          <p id="senhaMsg" class="text-green-600 mt-2"></p>
        </div>
        <!-- Logout -->
        <div>
          <button id="logoutBtn" class="bg-red-600 text-white font-semibold px-4 py-2 rounded-lg shadow hover:bg-red-700 transition duration-150">Sair do painel</button>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-orange-800 text-white text-center py-8 mt-12">
    <p>&copy; 2025 Comunidade Internacional Plenitude. Painel do Administrador.</p>
  </footer>

  <script type="module">
// ========== MÍDIAS SOCIAIS ==========
document.getElementById('formMidias').addEventListener('submit', async (e) => {
  e.preventDefault();
  const facebook = document.getElementById('midiaFacebook').value;
  const instagram = document.getElementById('midiaInstagram').value;
  const youtube = document.getElementById('midiaYoutube').value;
  await setDoc(doc(db, 'config', 'midias'), { facebook, instagram, youtube });
  document.getElementById('midiaMsg').textContent = 'Links salvos!';
});

// ========== POLÍTICA DE PRIVACIDADE ==========
document.getElementById('formPrivacidade').addEventListener('submit', async (e) => {
  e.preventDefault();
  const texto = document.getElementById('privacidadeTexto').value;
  await setDoc(doc(db, 'config', 'privacidade'), { texto });
  document.getElementById('privacidadeMsg').textContent = 'Política salva!';
});
// ========== MEDITAÇÕES ==========
import { addDoc as addDocMed, updateDoc as updateDocMed, deleteDoc as deleteDocMed } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
// Listar meditações
document.getElementById('btnListarMeditacoes').addEventListener('click', async () => {
  const meditacoesList = document.getElementById('meditacoesList');
  meditacoesList.innerHTML = '<p>Carregando...</p>';
  const meditacoesRef = collection(db, 'meditacoes');
  const meditacoesSnapshot = await getDocs(meditacoesRef);
  let html = '<table class="min-w-full"><thead><tr class="bg-orange-100"><th class="py-2 px-4">Tema</th><th class="py-2 px-4">Texto</th><th class="py-2 px-4">Versículo</th><th class="py-2 px-4">Ações</th></tr></thead><tbody>';
  meditacoesSnapshot.forEach(docSnap => {
    const med = docSnap.data();
    html += `<tr><td class="py-2 px-4">${med.tema}</td><td class="py-2 px-4">${med.texto}</td><td class="py-2 px-4">${med.versiculo}</td><td class="py-2 px-4"><button class="bg-blue-600 text-white px-2 py-1 rounded" data-id="${docSnap.id}">Editar</button> <button class="bg-red-600 text-white px-2 py-1 rounded" data-del="${docSnap.id}">Excluir</button></td></tr>`;
  });
  html += '</tbody></table>';
  meditacoesList.innerHTML = html;
  // Editar meditação
  Array.from(meditacoesList.querySelectorAll('button[data-id]')).forEach(btn => {
    btn.addEventListener('click', async () => {
      const id = btn.getAttribute('data-id');
      const medRef = doc(db, 'meditacoes', id);
      const medSnap = await getDoc(medRef);
      if (medSnap.exists()) {
        const med = medSnap.data();
        document.getElementById('meditacaoTema').value = med.tema;
        document.getElementById('meditacaoTexto').value = med.texto;
        document.getElementById('meditacaoVersiculo').value = med.versiculo;
        document.getElementById('formMeditacao').style.display = 'block';
        document.getElementById('formMeditacao').setAttribute('data-edit', id);
      }
    });
  });
  // Excluir meditação
  Array.from(meditacoesList.querySelectorAll('button[data-del]')).forEach(btn => {
    btn.addEventListener('click', async () => {
      const id = btn.getAttribute('data-del');
      await deleteDocMed(doc(db, 'meditacoes', id));
      meditacoesList.innerHTML = '<p>Meditação excluída!</p>';
      setTimeout(() => document.getElementById('btnListarMeditacoes').click(), 1000);
    });
  });
});
// Mostrar formulário de cadastro
document.getElementById('btnCadastrarMeditacao').addEventListener('click', () => {
  document.getElementById('formMeditacao').style.display = 'block';
  document.getElementById('meditacoesList').innerHTML = '';
  document.getElementById('formMeditacao').removeAttribute('data-edit');
});
document.getElementById('cancelarMeditacao').addEventListener('click', () => {
  document.getElementById('formMeditacao').style.display = 'none';
  document.getElementById('meditacaoMsg').textContent = '';
});
// Cadastrar/Editar meditação
document.getElementById('formMeditacao').addEventListener('submit', async (e) => {
  e.preventDefault();
  const tema = document.getElementById('meditacaoTema').value;
  const texto = document.getElementById('meditacaoTexto').value;
  const versiculo = document.getElementById('meditacaoVersiculo').value;
  const editId = document.getElementById('formMeditacao').getAttribute('data-edit');
  try {
    if (editId) {
      await updateDocMed(doc(db, 'meditacoes', editId), { tema, texto, versiculo });
      document.getElementById('meditacaoMsg').textContent = 'Meditação atualizada com sucesso!';
    } else {
      await addDocMed(collection(db, 'meditacoes'), { tema, texto, versiculo });
      document.getElementById('meditacaoMsg').textContent = 'Meditação cadastrada com sucesso!';
    }
    document.getElementById('formMeditacao').reset();
    document.getElementById('formMeditacao').style.display = 'none';
    setTimeout(() => document.getElementById('btnListarMeditacoes').click(), 1000);
  } catch (err) {
    document.getElementById('meditacaoMsg').textContent = 'Erro ao salvar meditação: ' + err.message;
  }
});
// ========== MINISTÉRIOS ==========
import { addDoc as addDocMin, updateDoc as updateDocMin, deleteDoc as deleteDocMin } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
// Listar ministérios
document.getElementById('btnListarMinisterios').addEventListener('click', async () => {
  const ministeriosList = document.getElementById('ministeriosList');
  ministeriosList.innerHTML = '<p>Carregando...</p>';
  const ministeriosRef = collection(db, 'ministerios');
  const ministeriosSnapshot = await getDocs(ministeriosRef);
  let html = '<table class="min-w-full"><thead><tr class="bg-orange-100"><th class="py-2 px-4">Nome</th><th class="py-2 px-4">Descrição</th><th class="py-2 px-4">Ações</th></tr></thead><tbody>';
  ministeriosSnapshot.forEach(docSnap => {
    const min = docSnap.data();
    html += `<tr><td class="py-2 px-4">${min.nome}</td><td class="py-2 px-4">${min.descricao}</td><td class="py-2 px-4"><button class="bg-blue-600 text-white px-2 py-1 rounded" data-id="${docSnap.id}">Editar</button> <button class="bg-red-600 text-white px-2 py-1 rounded" data-del="${docSnap.id}">Excluir</button></td></tr>`;
  });
  html += '</tbody></table>';
  ministeriosList.innerHTML = html;
  // Editar ministério
  Array.from(ministeriosList.querySelectorAll('button[data-id]')).forEach(btn => {
    btn.addEventListener('click', async () => {
      const id = btn.getAttribute('data-id');
      const minRef = doc(db, 'ministerios', id);
      const minSnap = await getDoc(minRef);
      if (minSnap.exists()) {
        const min = minSnap.data();
        document.getElementById('ministerioNome').value = min.nome;
        document.getElementById('ministerioDescricao').value = min.descricao;
        document.getElementById('formMinisterio').style.display = 'block';
        document.getElementById('formMinisterio').setAttribute('data-edit', id);
      }
    });
  });
  // Excluir ministério
  Array.from(ministeriosList.querySelectorAll('button[data-del]')).forEach(btn => {
    btn.addEventListener('click', async () => {
      const id = btn.getAttribute('data-del');
      await deleteDocMin(doc(db, 'ministerios', id));
      ministeriosList.innerHTML = '<p>Ministério excluído!</p>';
      setTimeout(() => document.getElementById('btnListarMinisterios').click(), 1000);
    });
  });
});
// Mostrar formulário de cadastro
document.getElementById('btnCadastrarMinisterio').addEventListener('click', () => {
  document.getElementById('formMinisterio').style.display = 'block';
  document.getElementById('ministeriosList').innerHTML = '';
  document.getElementById('formMinisterio').removeAttribute('data-edit');
});
document.getElementById('cancelarMinisterio').addEventListener('click', () => {
  document.getElementById('formMinisterio').style.display = 'none';
  document.getElementById('ministerioMsg').textContent = '';
});
// Cadastrar/Editar ministério
document.getElementById('formMinisterio').addEventListener('submit', async (e) => {
  e.preventDefault();
  const nome = document.getElementById('ministerioNome').value;
  const descricao = document.getElementById('ministerioDescricao').value;
  const editId = document.getElementById('formMinisterio').getAttribute('data-edit');
  try {
    if (editId) {
      await updateDocMin(doc(db, 'ministerios', editId), { nome, descricao });
      document.getElementById('ministerioMsg').textContent = 'Ministério atualizado com sucesso!';
    } else {
      await addDocMin(collection(db, 'ministerios'), { nome, descricao });
      document.getElementById('ministerioMsg').textContent = 'Ministério cadastrado com sucesso!';
    }
    document.getElementById('formMinisterio').reset();
    document.getElementById('formMinisterio').style.display = 'none';
    setTimeout(() => document.getElementById('btnListarMinisterios').click(), 1000);
  } catch (err) {
    document.getElementById('ministerioMsg').textContent = 'Erro ao salvar ministério: ' + err.message;
  }
});
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getFirestore, collection, getDocs, query, orderBy, limit, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut, updatePassword } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  // ========== GERENCIAMENTO DE USUÁRIOS ==========
  import { createUserWithEmailAndPassword, updateProfile, deleteUser, fetchSignInMethodsForEmail } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  // ========== GERENCIAMENTO DE CULTOS ==========
  import { addDoc, updateDoc, deleteDoc, Timestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  // Listar cultos
  document.getElementById('btnListarCultos').addEventListener('click', async () => {
    const cultosList = document.getElementById('cultosList');
    cultosList.innerHTML = '<p>Carregando...</p>';
    const cultosRef = collection(db, 'cultos');
    const cultosSnapshot = await getDocs(query(cultosRef, orderBy('data', 'desc')));
    let html = '<table class="min-w-full"><thead><tr class="bg-orange-100"><th class="py-2 px-4">Título</th><th class="py-2 px-4">Data</th><th class="py-2 px-4">Descrição</th><th class="py-2 px-4">Ações</th></tr></thead><tbody>';
    cultosSnapshot.forEach(docSnap => {
      const culto = docSnap.data();
      html += `<tr><td class="py-2 px-4">${culto.titulo}</td><td class="py-2 px-4">${culto.data ? new Date(culto.data.seconds * 1000).toLocaleString('pt-BR') : '--'}</td><td class="py-2 px-4">${culto.descricao}</td><td class="py-2 px-4"><button class="bg-blue-600 text-white px-2 py-1 rounded" data-id="${docSnap.id}">Editar</button> <button class="bg-red-600 text-white px-2 py-1 rounded" data-del="${docSnap.id}">Excluir</button></td></tr>`;
    });
    html += '</tbody></table>';
    cultosList.innerHTML = html;
    // Editar culto
    Array.from(cultosList.querySelectorAll('button[data-id]')).forEach(btn => {
      btn.addEventListener('click', async () => {
        const id = btn.getAttribute('data-id');
        const cultoRef = doc(db, 'cultos', id);
        const cultoSnap = await getDoc(cultoRef);
        if (cultoSnap.exists()) {
          const culto = cultoSnap.data();
          document.getElementById('cultoTitulo').value = culto.titulo;
          document.getElementById('cultoData').value = culto.data ? new Date(culto.data.seconds * 1000).toISOString().slice(0,16) : '';
          document.getElementById('cultoDescricao').value = culto.descricao;
          document.getElementById('formCulto').style.display = 'block';
          document.getElementById('formCulto').setAttribute('data-edit', id);
        }
      });
    });
    // Excluir culto
    Array.from(cultosList.querySelectorAll('button[data-del]')).forEach(btn => {
      btn.addEventListener('click', async () => {
        const id = btn.getAttribute('data-del');
        await deleteDoc(doc(db, 'cultos', id));
        cultosList.innerHTML = '<p>Culto excluído!</p>';
        setTimeout(() => document.getElementById('btnListarCultos').click(), 1000);
      });
    });
  });

  // Mostrar formulário de cadastro
  document.getElementById('btnCadastrarCulto').addEventListener('click', () => {
    document.getElementById('formCulto').style.display = 'block';
    document.getElementById('cultosList').innerHTML = '';
    document.getElementById('formCulto').removeAttribute('data-edit');
  });
  document.getElementById('cancelarCulto').addEventListener('click', () => {
    document.getElementById('formCulto').style.display = 'none';
    document.getElementById('cultoMsg').textContent = '';
  });

  // Cadastrar/Editar culto
  document.getElementById('formCulto').addEventListener('submit', async (e) => {
    e.preventDefault();
    const titulo = document.getElementById('cultoTitulo').value;
    const data = new Date(document.getElementById('cultoData').value);
    const descricao = document.getElementById('cultoDescricao').value;
    const editId = document.getElementById('formCulto').getAttribute('data-edit');
    try {
      if (editId) {
        await updateDoc(doc(db, 'cultos', editId), { titulo, data: Timestamp.fromDate(data), descricao });
        document.getElementById('cultoMsg').textContent = 'Culto atualizado com sucesso!';
      } else {
        await addDoc(collection(db, 'cultos'), { titulo, data: Timestamp.fromDate(data), descricao });
        document.getElementById('cultoMsg').textContent = 'Culto cadastrado com sucesso!';
      }
      document.getElementById('formCulto').reset();
      document.getElementById('formCulto').style.display = 'none';
      setTimeout(() => document.getElementById('btnListarCultos').click(), 1000);
    } catch (err) {
      document.getElementById('cultoMsg').textContent = 'Erro ao salvar culto: ' + err.message;
    }
  });

  // Listar usuários (apenas emails cadastrados)
  document.getElementById('btnListarUsuarios').addEventListener('click', async () => {
    const usuariosList = document.getElementById('usuariosList');
    usuariosList.innerHTML = '<p>Carregando...</p>';
    // Firebase Auth não permite listar todos os usuários pelo client, apenas pelo Admin SDK (Node.js).
    usuariosList.innerHTML = '<p>Por segurança, o painel só permite cadastrar novos usuários e buscar por e-mail.</p>';
  });

  // Mostrar formulário de cadastro
  document.getElementById('btnCadastrarUsuario').addEventListener('click', () => {
    document.getElementById('formUsuario').style.display = 'block';
    document.getElementById('usuariosList').innerHTML = '';
  });
  document.getElementById('cancelarUsuario').addEventListener('click', () => {
    document.getElementById('formUsuario').style.display = 'none';
    document.getElementById('usuarioMsg').textContent = '';
  });

  // Cadastrar usuário
  document.getElementById('formUsuario').addEventListener('submit', async (e) => {
    e.preventDefault();
    const nome = document.getElementById('usuarioNome').value;
    const email = document.getElementById('usuarioEmail').value;
    const senha = document.getElementById('usuarioSenha').value;
    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, senha);
      await updateProfile(userCredential.user, { displayName: nome });
      document.getElementById('usuarioMsg').textContent = 'Usuário cadastrado com sucesso!';
      document.getElementById('formUsuario').reset();
      document.getElementById('formUsuario').style.display = 'none';
    } catch (err) {
      document.getElementById('usuarioMsg').textContent = 'Erro ao cadastrar usuário: ' + err.message;
    }
  });

  // ========== GERENCIAMENTO DE MENSAGENS ==========
  // Adiciona botão de excluir mensagem
  function renderMensagens(mensagens) {
    const tbody = document.getElementById('mensagensTable');
    tbody.innerHTML = '';
    mensagens.forEach((msg, idx) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="py-2 px-4">${msg.name}</td>
        <td class="py-2 px-4">${msg.email}</td>
        <td class="py-2 px-4">${msg.phone}</td>
        <td class="py-2 px-4">${msg.isWhatsApp}</td>
        <td class="py-2 px-4">${msg.message}</td>
        <td class="py-2 px-4">${msg.timestamp ? new Date(msg.timestamp.seconds * 1000).toLocaleString('pt-BR') : '--'}</td>
        <td class="py-2 px-4"><button class="bg-red-600 text-white px-2 py-1 rounded" data-idx="${idx}">Excluir</button></td>
      `;
      tbody.appendChild(tr);
    });
    // Adiciona evento de exclusão
    Array.from(tbody.querySelectorAll('button')).forEach(btn => {
      btn.addEventListener('click', async () => {
        const i = btn.getAttribute('data-idx');
        const mensagensRef = collection(db, 'mensagens');
        const mensagensSnapshot = await getDocs(query(mensagensRef, orderBy('timestamp', 'desc')));
        let idToDelete = null;
        let idx = 0;
        mensagensSnapshot.forEach(docSnap => {
          if (idx == i) idToDelete = docSnap.id;
          idx++;
        });
        if (idToDelete) {
          await setDoc(doc(db, 'mensagens', idToDelete), {}, { merge: false }); // Limpa o doc
          document.getElementById('totalMensagens').textContent = mensagens.length - 1;
          carregarMensagens();
        }
      });
    });
  }

  // Sobrescreve carregarMensagens para usar renderMensagens
  async function carregarMensagens() {
    const mensagensRef = collection(db, 'mensagens');
    const mensagensSnapshot = await getDocs(query(mensagensRef, orderBy('timestamp', 'desc')));
    const mensagens = [];
    mensagensSnapshot.forEach(doc => {
      mensagens.push(doc.data());
    });
    document.getElementById('totalMensagens').textContent = mensagens.length;
    if (mensagens.length > 0) {
      document.getElementById('ultimaMensagem').textContent = mensagens[0].message;
    }
    renderMensagens(mensagens);
  }

  // ========== EXPORTAR CSV ==========
  document.getElementById('btnExportarCSV').addEventListener('click', async () => {
    const mensagensRef = collection(db, 'mensagens');
    const mensagensSnapshot = await getDocs(query(mensagensRef, orderBy('timestamp', 'desc')));
    let csv = 'Nome,E-mail,Telefone,WhatsApp,Mensagem,Data\n';
    mensagensSnapshot.forEach(doc => {
      const msg = doc.data();
      csv += `${msg.name},${msg.email},${msg.phone},${msg.isWhatsApp},${msg.message},${msg.timestamp ? new Date(msg.timestamp.seconds * 1000).toLocaleString('pt-BR') : '--'}\n`;
    });
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'mensagens.csv';
    a.click();
    URL.revokeObjectURL(url);
  });

  // ========== ESTATÍSTICAS (GRÁFICO) ==========
  import Chart from "https://cdn.jsdelivr.net/npm/chart.js";
  async function carregarEstatisticas() {
    const mensagensRef = collection(db, 'mensagens');
    const mensagensSnapshot = await getDocs(mensagensRef);
    const porMes = {};
    mensagensSnapshot.forEach(doc => {
      const msg = doc.data();
      if (msg.timestamp) {
        const mes = new Date(msg.timestamp.seconds * 1000).toLocaleString('pt-BR', { month: 'short', year: 'numeric' });
        porMes[mes] = (porMes[mes] || 0) + 1;
      }
    });
    const ctx = document.getElementById('graficoMensagens').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: Object.keys(porMes),
        datasets: [{ label: 'Mensagens por mês', data: Object.values(porMes), backgroundColor: 'rgba(255, 115, 0, 0.7)' }]
      }
    });
  }

  // ========== PERMISSÕES (EXEMPLO SIMPLES) ==========
  // Para permissões avançadas, usar custom claims via Admin SDK. Aqui, apenas exibe o email do usuário logado.
  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById('loginContainer').style.display = 'none';
      document.getElementById('adminPanel').style.display = 'block';
      carregarMensagens();
      contarUsuarios();
      carregarBanner();
      carregarEstatisticas();
      // Exibe email do admin logado
      if (!document.getElementById('adminEmail')) {
        const nav = document.querySelector('nav');
        const span = document.createElement('span');
        span.id = 'adminEmail';
        span.className = 'ml-4 text-sm bg-orange-900 px-2 py-1 rounded';
        span.textContent = 'Logado como: ' + user.email;
        nav.appendChild(span);
      }
    } else {
      document.getElementById('loginContainer').style.display = 'flex';
      document.getElementById('adminPanel').style.display = 'none';
    }
  });

    const firebaseConfig = {
      apiKey: "AIzaSyAxuEEDjn6lPfKOysOcQjvWvUWqJL_990o",
      authDomain: "c-i-plenitude.firebaseapp.com",
      projectId: "c-i-plenitude",
      storageBucket: "c-i-plenitude.appspot.com",
      messagingSenderId: "126733729315",
      appId: "1:126733729315:web:9f247cd8f854fb2e0fbb96",
      measurementId: "G-CGG5MZB9P1"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // Banner: buscar e exibir prévia
    async function carregarBanner() {
      const bannerDoc = await getDoc(doc(db, 'config', 'banner'));
      if (bannerDoc.exists()) {
        const url = bannerDoc.data().url;
        document.getElementById('bannerPreview').src = url;
        document.getElementById('bannerPreview').style.display = 'block';
      }
    }

    document.getElementById('bannerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const url = document.getElementById('bannerUrl').value;
      await setDoc(doc(db, 'config', 'banner'), { url });
      document.getElementById('bannerMsg').textContent = 'Banner atualizado!';
      document.getElementById('bannerPreview').src = url;
      document.getElementById('bannerPreview').style.display = 'block';
    });

    // Alterar senha
    document.getElementById('senhaForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const novaSenha = document.getElementById('novaSenha').value;
      try {
        await updatePassword(auth.currentUser, novaSenha);
        document.getElementById('senhaMsg').textContent = 'Senha alterada com sucesso!';
      } catch (err) {
        document.getElementById('senhaMsg').textContent = 'Erro ao alterar senha.';
      }
    });

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', async () => {
      await signOut(auth);
      window.location.reload();
    });

    // Exibe painel admin apenas se autenticado
    onAuthStateChanged(auth, (user) => {
      if (user) {
        document.getElementById('loginContainer').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        carregarMensagens();
        contarUsuarios();
        carregarBanner();
      } else {
        document.getElementById('loginContainer').style.display = 'flex';
        document.getElementById('adminPanel').style.display = 'none';
      }
    });

    // Login
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
        document.getElementById('loginError').textContent = '';
      } catch (error) {
        document.getElementById('loginError').textContent = 'E-mail ou senha inválidos.';
      }
    });
    async function carregarMensagens() {
      const mensagensRef = collection(db, 'mensagens');
      const mensagensSnapshot = await getDocs(query(mensagensRef, orderBy('timestamp', 'desc')));
      const mensagens = [];
      mensagensSnapshot.forEach(doc => {
        mensagens.push(doc.data());
      });
      document.getElementById('totalMensagens').textContent = mensagens.length;
      if (mensagens.length > 0) {
        document.getElementById('ultimaMensagem').textContent = mensagens[0].message;
      }
      const tbody = document.getElementById('mensagensTable');
      tbody.innerHTML = '';
      mensagens.forEach(msg => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="py-2 px-4">${msg.name}</td>
          <td class="py-2 px-4">${msg.email}</td>
          <td class="py-2 px-4">${msg.phone}</td>
          <td class="py-2 px-4">${msg.isWhatsApp}</td>
          <td class="py-2 px-4">${msg.message}</td>
          <td class="py-2 px-4">${msg.timestamp ? new Date(msg.timestamp.seconds * 1000).toLocaleString('pt-BR') : '--'}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    async function contarUsuarios() {
      // Exemplo: contar usuários únicos pela coleção de mensagens
      const mensagensRef = collection(db, 'mensagens');
      const mensagensSnapshot = await getDocs(mensagensRef);
      const userIds = new Set();
      mensagensSnapshot.forEach(doc => {
        const data = doc.data();
        if (data.userId) userIds.add(data.userId);
      });
      document.getElementById('usuariosAtivos').textContent = userIds.size;
    }

  // Removido: só carrega após login
  </script>
</body>
</html>
